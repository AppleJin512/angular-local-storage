/**
 * An Angular module that gives you access to the browsers local storage
 * @version v0.6.0 - 2017-06-21
 * @link https://github.com/grevory/angular-local-storage
 * @author grevory <greg@gregpike.ca>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(e,t){var o=t.isDefined,r=t.isUndefined,n=t.isNumber,i=t.isObject,a=t.isArray,c=t.isString,s=t.extend,u=t.toJson;t.module("LocalStorageModule",[]).provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/",secure:!1},this.defaultToCookie=!0,this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(e){return this.prefix=e,this},this.setStorageType=function(e){return this.storageType=e,this},this.setDefaultToCookie=function(e){return this.defaultToCookie=!!e,this},this.setStorageCookie=function(e,t,o){return this.cookie.expiry=e,this.cookie.path=t,this.cookie.secure=o,this},this.setStorageCookieDomain=function(e){return this.cookie.domain=e,this},this.setNotify=function(e,t){return this.notify={setItem:e,removeItem:t},this},this.$get=["$rootScope","$window","$document","$parse","$timeout",function(e,t,l,f,g){function d(o){if(o||(o=t.event),p.setItem&&c(o.key)&&O(o.key)){var r=k(o.key);g(function(){e.$broadcast("LocalStorageModule.notification.changed",{key:r,newvalue:o.newValue,storageType:y.storageType})})}}var h,y=this,T=y.prefix,m=y.cookie,p=y.notify,v=y.storageType;l?l[0]&&(l=l[0]):l=document,"."!==T.substr(-1)&&(T=T?T+".":"");var S=function(e){return T+e},k=function(e){return e.replace(new RegExp("^"+T,"g"),"")},O=function(e){return 0===e.indexOf(T)},b=function(){try{var o=v in t&&null!==t[v],r=S("__"+Math.round(1e7*Math.random()));return o&&((h=t[v]).setItem(r,""),h.removeItem(r)),o}catch(t){return y.defaultToCookie&&(v="cookie"),e.$broadcast("LocalStorageModule.notification.error",t.message),!1}},L=b(),$=function(t,o,n){var i=I();try{if(P(n),o=r(o)?null:u(o),!L&&y.defaultToCookie||"cookie"===y.storageType)return L||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.setItem&&e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:o,storageType:"cookie"}),w(t,o);try{h&&h.setItem(S(t),o),p.setItem&&e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:o,storageType:y.storageType})}catch(r){return e.$broadcast("LocalStorageModule.notification.error",r.message),w(t,o)}return!0}finally{P(i)}},E=function(t,o){var r=I();try{if(P(o),!L&&y.defaultToCookie||"cookie"===y.storageType)return L||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),C(t);var n=h?h.getItem(S(t)):null;if(!n||"null"===n)return null;try{return JSON.parse(n)}catch(e){return n}}finally{P(r)}},M=function(){var t=I();try{var o=0;arguments.length>=1&&("localStorage"===arguments[arguments.length-1]||"sessionStorage"===arguments[arguments.length-1])&&(o=1,P(arguments[arguments.length-1]));var r,n;for(r=0;r<arguments.length-o;r++)if(n=arguments[r],!L&&y.defaultToCookie||"cookie"===y.storageType)L||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.removeItem&&e.$broadcast("LocalStorageModule.notification.removeitem",{key:n,storageType:"cookie"}),_(n);else try{h.removeItem(S(n)),p.removeItem&&e.$broadcast("LocalStorageModule.notification.removeitem",{key:n,storageType:y.storageType})}catch(t){e.$broadcast("LocalStorageModule.notification.error",t.message),_(n)}}finally{P(t)}},x=function(){try{return t.navigator.cookieEnabled||"cookie"in l&&(l.cookie.length>0||(l.cookie="test").indexOf.call(l.cookie,"test")>-1)}catch(t){return e.$broadcast("LocalStorageModule.notification.error",t.message),!1}}(),w=function(t,o,c,s){if(r(o))return!1;if((a(o)||i(o))&&(o=u(o)),!x)return e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var f="",g=new Date,d="";if(null===o?(g.setTime(g.getTime()+-864e5),f="; expires="+g.toGMTString(),o=""):n(c)&&0!==c?(g.setTime(g.getTime()+24*c*60*60*1e3),f="; expires="+g.toGMTString()):0!==m.expiry&&(g.setTime(g.getTime()+24*m.expiry*60*60*1e3),f="; expires="+g.toGMTString()),t){var h="; path="+m.path;m.domain&&(d="; domain="+m.domain),"boolean"==typeof s?!0===s&&(d+="; secure"):!0===m.secure&&(d+="; secure"),l.cookie=S(t)+"="+encodeURIComponent(o)+f+h+d}}catch(t){return e.$broadcast("LocalStorageModule.notification.error",t.message),!1}return!0},C=function(t){if(!x)return e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var o=l.cookie&&l.cookie.split(";")||[],r=0;r<o.length;r++){for(var n=o[r];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(S(t)+"=")){var i=decodeURIComponent(n.substring(T.length+t.length+1,n.length));try{var a=JSON.parse(i);return"number"==typeof a?i:a}catch(e){return i}}}return null},_=function(e){w(e,null)},R=function(){for(var e=null,t=T.length,o=l.cookie.split(";"),r=0;r<o.length;r++){for(e=o[r];" "===e.charAt(0);)e=e.substring(1,e.length);var n=e.substring(t,e.indexOf("="));_(n)}},I=function(){return v},P=function(e){return e&&v!==e&&(v=e,L=b()),L};L&&(t.addEventListener?(t.addEventListener("storage",d,!1),e.$on("$destroy",function(){t.removeEventListener("storage",d)})):t.attachEvent&&(t.attachEvent("onstorage",d),e.$on("$destroy",function(){t.detachEvent("onstorage",d)})));return{isSupported:L,getStorageType:I,setStorageType:P,setPrefix:function(e){T=e},set:$,add:$,get:E,keys:function(t){var o=I();try{if(P(t),!L)return e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),[];var r=T.length,n=[];for(var i in h)if(i.substr(0,r)===T)try{n.push(i.substr(r))}catch(t){return e.$broadcast("LocalStorageModule.notification.error",t.Description),[]}return n}finally{P(o)}},remove:M,clearAll:function(t,o){var r=I();try{P(o);var n=T?new RegExp("^"+T):new RegExp,i=t?new RegExp(t):new RegExp;if(!L&&y.defaultToCookie||"cookie"===y.storageType)return L||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),R();if(!L&&!y.defaultToCookie)return!1;var a=T.length;for(var c in h)if(n.test(c)&&i.test(c.substr(a)))try{M(c.substr(a))}catch(t){return e.$broadcast("LocalStorageModule.notification.error",t.message),R()}return!0}finally{P(r)}},bind:function(e,t,r,n,a){var c=E(n=n||t,a);return null===c&&o(r)?c=r:i(c)&&i(r)&&(c=s(c,r)),f(t).assign(e,c),e.$watch(t,function(e){$(n,e,a)},i(e[t]))},deriveKey:S,underiveKey:k,length:function(e){var o=I();try{P(e);for(var r=0,n=t[v],i=0;i<n.length;i++)0===n.key(i).indexOf(T)&&r++;return r}finally{P(o)}},defaultToCookie:this.defaultToCookie,cookie:{isSupported:x,set:w,add:w,get:C,remove:_,clearAll:R}}}]})}(window,window.angular);
//# sourceMappingURL=angular-local-storage.min.js.map